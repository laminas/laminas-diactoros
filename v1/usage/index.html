<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PSR-7 HTTP message implementations">  
    <link rel="canonical" href="https://docs.laminas.dev/laminas-diactoros/v1/usage/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>Usage - laminas-diactoros - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
    
</head>
<body id="page-top" class="components" data-spy="scroll" data-target=".toc" data-offset="20">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="https://docs.laminas.dev/components">Components</a>
                            <a class="dropdown-item" href="https://docs.mezzio.dev/">Mezzio</a>
                            <a class="dropdown-item" href="https://api-tools.getlaminas.org/">API Tools</a>
                            <a class="dropdown-item" href="https://docs.laminas.dev/mvc">MVC</a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">laminas-diactoros</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../overview/" class="subnavigation__link">Overview</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation</a>
    </li>

                    
                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Usage</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../custom-responses/" class="subnavigation__link">Custom Responses</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../emitting-responses/" class="subnavigation__link">Emitting Responses</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../serialization/" class="subnavigation__link">Serialization</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API</a>
    </li>

            
        </ul>
    </li>

                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-8">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-diactoros</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-sm-right">
                
                    
<div class="version-selector">
    <div class="btn-group">
        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="version-selector-dropdown">
            
                v1
            
        </button>
        <div class="dropdown-menu" aria-labelledby="version-selector-dropdown">
            
                
                    <a href="../../v2/overview/" class="dropdown-item">
                        
                            v2 (latest)
                        
                    </a>
                
            
                
                    <a href="../overview/" class="dropdown-item active">
                        
                            v1
                        
                    </a>
                
            
        </div>
    </div>
</div>


                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-diactoros/" class="header__link header__link--github" title="Go to repository of laminas-diactoros">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-12 content" role="main">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#http-clients" class="toc__link nav-link">HTTP Clients</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#server-side-applications" class="toc__link nav-link">Server-Side Applications</a>
                    </li>
                
            </ul>
        </div>
    

                

                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="../..">laminas-diactoros</a></li>

                
                    
                        
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">Usage</li>
            
        
    </ol>
</nav>



    <div class="alert alert-danger" role="alert">
        <h4>Caution</h4>
        <p>
            The documentation you are viewing is for an older version of this component.<br>
            <a href="../..">Switch to the latest (v2) version.</a>
        </p>
    </div>




    
    

    <h1 id="usage">Usage</h1>
<p>Usage will differ based on whether you are writing an HTTP client, or a server-side application.</p>
<p>For HTTP client purposes, you will create and populate a <code>Request</code> instance, and the client should
return a <code>Response</code> instance.</p>
<p>For server-side applications, you will create a <code>ServerRequest</code> instance, and populate and return a
<code>Response</code> instance.</p>
<h2 id="http-clients">HTTP Clients</h2>
<p>A client will <em>send</em> a request, and <em>return</em> a response. As a developer, you will <em>create</em> and
<em>populate</em> the request, and then <em>introspect</em> the response.  Both requests and responses are
immutable; if you make changes &mdash; e.g., by calling setter methods &mdash; you must capture the return
value, as it is a new instance.</p>
<pre class=codehilite><code class=language-php>// Create a request
$request = (new Laminas\Diactoros\Request())
    -&gt;withUri(new Laminas\Diactoros\Uri('http://example.com'))
    -&gt;withMethod('PATCH')
    -&gt;withAddedHeader('Authorization', 'Bearer ' . $token)
    -&gt;withAddedHeader('Content-Type', 'application/json');

// OR:
$request = new Laminas\Diactoros\Request(
    'http://example.com',
    'PATCH',
    'php://memory',
    [
        'Authorization' =&gt; 'Bearer ' . $token,
        'Content-Type'  =&gt; 'application/json',
    ]
);

// If you want to set a non-origin-form request target, set the
// request-target explicitly:
$request = $request-&gt;withRequestTarget((string) $uri);       // absolute-form
$request = $request-&gt;withRequestTarget($uri-&gt;getAuthority()); // authority-form
$request = $request-&gt;withRequestTarget('*');                 // asterisk-form

// Once you have the instance:
$request-&gt;getBody()-&gt;write(json_encode($data));
$response = $client-&gt;send($request);

printf(&quot;Response status: %d (%s)\n&quot;, $response-&gt;getStatusCode(), $response-&gt;getReasonPhrase());
printf(&quot;Headers:\n&quot;);
foreach ($response-&gt;getHeaders() as $header =&gt; $values) {
    printf(&quot;    %s: %s\n&quot;, $header, implode(', ', $values));
}
printf(&quot;Message:\n%s\n&quot;, $response-&gt;getBody());</code></pre>
<p>(Note: <code>laminas-diactoros</code> does NOT ship with a client implementation; the above is just an
illustration of a possible implementation.)</p>
<h2 id="server-side-applications">Server-Side Applications</h2>
<p>Server-side applications will need to marshal the incoming request based on superglobals, and will
then populate and send a response.</p>
<h3>Marshaling an incoming Request</h3>
<p>PHP contains a plethora of information about the incoming request, and keeps that information in a
variety of locations. <code>Laminas\Diactoros\ServerRequestFactory::fromGlobals()</code> can simplify marshaling
that information into a request instance.</p>
<p>You can call the factory method with or without the following arguments, in the following order:</p>
<ul>
<li><code>$server</code>, typically <code>$_SERVER</code></li>
<li><code>$query</code>, typically <code>$_GET</code></li>
<li><code>$body</code>, typically <code>$_POST</code></li>
<li><code>$cookies</code>, typically <code>$_COOKIE</code></li>
<li><code>$files</code>, typically <code>$_FILES</code></li>
</ul>
<p>The method will then return a <code>Laminas\Diactoros\ServerRequest</code> instance. If any argument is omitted,
the associated superglobal will be used.</p>
<pre class=codehilite><code class=language-php>$request = Laminas\Diactoros\ServerRequestFactory::fromGlobals(
    $_SERVER,
    $_GET,
    $_POST,
    $_COOKIE,
    $_FILES
);</code></pre>
<p>When no cookie array is supplied, <code>fromGlobals</code> will first try to parse the supplied <code>cookie</code> header
before falling back to the <code>$_COOKIE</code> superglobal. This is done because PHP has some legacy handling
for request parameters which were then registered as global variables. Due to this, cookies with a period
in the name were renamed with underlines. By getting the cookies directly from the cookie header, you have
access to the original cookies in the way you set them in your application and they are send by the user
agent.</p>
<h3>Manipulating the Response</h3>
<p>Use the response object to add headers and provide content for the response.  Writing to the body
does not create a state change in the response, so it can be done without capturing the return
value. Manipulating headers does, however.</p>
<pre class=codehilite><code class=language-php>$response = new Laminas\Diactoros\Response();

// Write to the response body:
$response-&gt;getBody()-&gt;write(&quot;some content\n&quot;);

// Multiple calls to write() append:
$response-&gt;getBody()-&gt;write(&quot;more content\n&quot;); // now &quot;some content\nmore content\n&quot;

// Add headers
// Note: headers do not need to be added before data is written to the body!
$response = $response
    -&gt;withHeader('Content-Type', 'text/plain')
    -&gt;withAddedHeader('X-Show-Something', 'something');</code></pre>
<h3>"Serving" an Application</h3>
<blockquote>
<h3>Deprecated</h3>
<p>The class <code>Laminas\Diactoros\Server</code> is deprecated as of the 1.8.0 release. We
recommend using the class <code>Laminas\HttpHandlerRunner\RequestHandlerRunner</code> via
the package <a href="https://docs.laminas.dev/laminas-httphandlerrunner">laminas/laminas-httphandlerrunner</a>
instead.</p>
</blockquote>
<p><code>Laminas\Diactoros\Server</code> mimics a portion of the API of node's <code>http.Server</code> class. It invokes a
callback, passing it an <code>ServerRequest</code>, an <code>Response</code>, and optionally a callback to use for
incomplete/unhandled requests.</p>
<p>You can create a server in one of three ways:</p>
<pre class=codehilite><code class=language-php>// Direct instantiation, with a callback handler, request, and response
$server = new Laminas\Diactoros\Server(
    function ($request, $response, $done) {
        $response-&gt;getBody()-&gt;write(&quot;Hello world!&quot;);
    },
    $request,
    $response
);

// Using the createServer factory, providing it with the various superglobals:
$server = Laminas\Diactoros\Server::createServer(
    function ($request, $response, $done) {
        $response-&gt;getBody()-&gt;write(&quot;Hello world!&quot;);
    },
    $_SERVER,
    $_GET,
    $_POST,
    $_COOKIE,
    $_FILES
);

// Using the createServerFromRequest factory, and providing it a request:
$server = Laminas\Diactoros\Server::createServerFromRequest(
  function ($request, $response, $done) {
      $response-&gt;getBody()-&gt;write(&quot;Hello world!&quot;);
  },
  $request
);</code></pre>
<p>Server callbacks can expect up to three arguments, in the following order:</p>
<ul>
<li><code>$request</code> - the request object</li>
<li><code>$response</code> - the response object</li>
<li><code>$done</code> - an optional callback to call when complete</li>
</ul>
<p>Once you have your server instance, you must instruct it to listen:</p>
<pre class=codehilite><code class=language-php>$server-&gt;listen();</code></pre>
<p>At this time, you can optionally provide a callback to <code>listen()</code>; this will be passed to the
handler as the third argument (<code>$done</code>):</p>
<pre class=codehilite><code class=language-php>$server-&gt;listen(function ($request, $response, $error = null) {
    if (! $error) {
        return;
    }
    // do something with the error...
});</code></pre>
<p>Typically, the <code>listen</code> callback will be an error handler, and can expect to receive the request,
response, and error as its arguments (though the error may be null).</p>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../install/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../custom-responses/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/laminas/laminas-diactoros/edit/master/docs/book/v1/usage.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">laminas-diactoros</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../overview/" class="subnavigation__link">Overview</a>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation</a>
    </li>

                    
                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Usage</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../custom-responses/" class="subnavigation__link">Custom Responses</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../emitting-responses/" class="subnavigation__link">Emitting Responses</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../serialization/" class="subnavigation__link">Serialization</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API</a>
    </li>

            
        </ul>
    </li>

                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Laminas API Tools <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-diactoros/blob/master/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-diactoros/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2019-2020 by <a href="https://getlaminas.org/">The Laminas Project</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '../..',
            project  = "components",
            siteName = 'laminas-diactoros';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
    
        <script src="../../search/main.js"></script>
    

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-diactoros" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
